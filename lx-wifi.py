#!/usr/bin/env python2
# -*- coding: utf-8 -*-

import urllib2
import cookielib
import time
import re
print 'Start'
print 'Wait A Moment'

#get the ip of wireless network adapter
url = "http://sj.dglongxi.com:88/?nasIp=113.98.10.144&nasPortId=DG-WJ-BAS-3.-43001290200000@vlan"
headers = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:14.0) Gecko/20100101 Firefox/14.0.1',
           'Referer' : 'http://sj.dglongxi.com:88/?nasIp=113.98.10.144&nasPortId=DG-WJ-BAS-3.-43001290200000@vlan'}
request = urllib2.Request(url,headers=headers)
response = urllib2.urlopen(request)
text = response.read().decode('utf-8')
localip = re.search('119.\d+.\d+.\d+',text)
if localip == None:
    print 'Please unplug the network cable and connect to WIFI.\n'
    raw_input()
    exit()
localip = localip.group()
print localip

#login
hosturl = 'http://sj.dglongxi.com:88/Weixin.aspx?nasIp=113.98.10.144' \
          '&nasPortId=DG-WJ-BAS-3.-43001290200000%vlan&ip='
hosturl = hosturl + localip + '&mac='

cj = cookielib.LWPCookieJar()
cookie_support = urllib2.HTTPCookieProcessor(cj)
opener = urllib2.build_opener(cookie_support, urllib2.HTTPHandler)
urllib2.install_opener(opener)

h = urllib2.urlopen(hosturl)
postData = '__VIEWSTATE=%2FwEPDwULLTE3MTc4Nzg1MTVkZCq9h%2BftRRY%2Fu04HpKFIVPCw314wEn0AtpMtlrxX2jVP&__VIEWSTATEGENERATOR=79323071&__EVENTVALIDATION=%2FwEWAwLwwNWQCAK2xpONDwKBk7XADC4BQdj5QRNnVO46EHLJd%2FkvExw%2FAgGgV8RYixzJe6wH&tb_pw=13579&btn_ok=%E8%BF%9E%E6%8E%A5%E4%B8%8A%E7%BD%91'
request = urllib2.Request(hosturl, postData, headers)
print request
response = urllib2.urlopen(request)
text = response.read()
print text

print        11111111111111111111111111111111111111001111111111111111111111111
time.sleep(0.1)
print        11111111111111111111111111111111111100011111111111111111111111111
time.sleep(0.4)
print        11111111111111111111111111111111100001111111111111111111111111111
print        11111111111111111111111111111110000111111111111111111111111111111
time.sleep(0.08)
print        11111111111111111111111111111000000111111111111111111111111111111
time.sleep(0.3)
print        11111111111111111111111111100000011110001100000000000000011111111
time.sleep(0.08)
print        11111111111111111100000000000000000000000000000000011111111111111
time.sleep(0.08)
print        11111111111111110111000000000000000000000000000011111111111111111
time.sleep(0.25)
print        11111111111111111111111000000000000000000000000000000000111111111
print        11111111111111111110000000000000000000000000000000111111111111111
time.sleep(0.08)
print        11111111111111111100011100000000000000000000000000000111111111111
time.sleep(0.08)
print        11111111111111100000110000000000011000000000000000000011111111111
time.sleep(0.15)
print        11111111111111000000000000000100111100000000000001100000111111111
print        11111111110000000000000000001110111110000000000000111000011111111
time.sleep(0.08)
print        11111111000000000000000000011111111100000000000000011110001111111
time.sleep(0.1)
print        11111110000000011111111111111111111100000000000000001111100111111
time.sleep(0.08)
print        11111111000001111111111111111111110000000000000000001111111111111
print        11111111110111111111111111111100000000000000000000000111111111111
time.sleep(0.08)
print        11111111111111110000000000000000000000000000000000000111111111111
time.sleep(0.08)
print        11111111111111111100000000000000000000000000001100000111111111111
print        11111111111111000000000000000000000000000000111100000111111111111
print        11111111111000000000000000000000000000000001111110000111111111111
print        11111111100000000000000000000000000000001111111110000111111111111
time.sleep(0.08)
print        11111110000000000000000000000000000000111111111110000111111111111
time.sleep(0.08)
print        11111100000000000000000001110000001111111111111110001111111111111
print        11111000000000000000011111111111111111111111111110011111111111111
print        11110000000000000001111111111111111100111111111111111111111111111
time.sleep(0.08)
print        11100000000000000011111111111111111111100001111111111111111111111
print        11100000000001000111111111111111111111111000001111111111111111111
time.sleep(0.08)
print        11000000000001100111111111111111111111111110000000111111111111111
print        11000000000000111011111111111100011111000011100000001111111111111
print        11000000000000011111111111111111000111110000000000000011111111111
print        11000000000000000011111111111111000000000000000000000000111111111
print        11001000000000000000001111111110000000000000000000000000001111111
time.sleep(0.1)
print        11100110000000000001111111110000000000000000111000000000000111111
print        11110110000000000000000000000000000000000111111111110000000011111
print        11111110000000000000000000000000000000001111111111111100000001111
print        11111110000010000000000000000001100000000111011111111110000001111
print        11111111000111110000000000000111110000000000111111111110110000111
print        11111110001111111100010000000001111100000111111111111111110000111
time.sleep(0.1)
print        11111110001111111111111110000000111111100000000111111111111000111
print        11111111001111111111111111111000000111111111111111111111111100011
print        11111111101111111111111111111110000111111111111111111111111001111
print        11111111111111111111111111111110001111111111111111111111100111111
print        11111111111111111111111111111111001111111111111111111111001111111
print        11111111111111111111111111111111100111111111111111111111111111111
time.sleep(0.08)
print        11111111111111111111111111111111110111111111111111111111111111111

print '       | | | | | | | | | | | | | | | | | | | | | | | | |     ',
print '\n'
print '\n'
print '                 Produce by blog.longlongjin.com                  '
print '                                SoyM                       '
print '       | | | | | | | | | | | | | | | | | | | | | | | | |   \n\n\n\n  ',

content = raw_input("Please press enter to exit or press'n'to have a heartbeat.\n\n\n\n\n\n")
if (content != "n"):
    exit()
else:
    print 'Now we start a heartbeat.'
    timer = 0
while True:
    timer = timer+1
    request = urllib2.Request(hosturl, postData, headers)
    response = urllib2.urlopen(request)
    print 'A heartbeat was done.'
    time.sleep(120)
